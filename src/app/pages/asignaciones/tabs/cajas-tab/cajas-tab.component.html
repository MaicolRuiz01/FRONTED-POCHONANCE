<!-- cajas-tab.component.html -->
<div class="ng-container">
  <h1>Cajas</h1>
</div>

<p-button
  icon="pi pi-plus"
  title="Agregar Caja"
  styleClass="p-button-success p-button-rounded p-button-sm"
  (click)="abrirCrearCaja()">
</p-button>

<br /><br />

<p-table [value]="cajas" [loading]="loadingCajas">
  <ng-template pTemplate="header">
    <tr>
      <th>Nombre</th>
      <th>Saldo</th>
      <th style="width: 120px;">Acciones</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-caja>
    <tr (click)="verMovimientos(caja)" style="cursor: pointer;">
      <td>{{ caja.name }}</td>
      <td>{{ caja.saldo | currency:'COP' }}</td>
      <td>
        <button pButton
                type="button"
                icon="pi pi-eye"
                class="p-button-text p-button-sm"
                (click)="$event.stopPropagation(); verMovimientos(caja)">
        </button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="3">No hay cajas registradas.</td>
    </tr>
  </ng-template>
</p-table>

<!-- Modal: Crear Caja -->
<p-dialog header="Crear Nueva Caja"
          [(visible)]="displayCajaDialog"
          [modal]="true"
          [style]="{ width: '380px' }">

  <div class="p-fluid">
    <div class="p-field">
      <label>Nombre de Caja</label>
      <input type="text" pInputText [(ngModel)]="nuevaCaja.name" />
    </div>

    <div class="p-field">
      <label>Saldo Inicial</label>
      <input type="number" pInputText [(ngModel)]="nuevaCaja.saldo" />
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" (click)="displayCajaDialog = false" class="p-button-text"></button>
    <button pButton label="Guardar" class="p-button-success" (click)="guardarCaja()"></button>
  </ng-template>
</p-dialog>

<!-- Modal: Movimientos de la Caja -->
<p-dialog header="Movimientos de Caja: {{ cajaSeleccionada?.name }}"
          [(visible)]="showMovsDialog"
          [modal]="true"
          [style]="{ width: '80vw' }"
          [closable]="true">

  <ng-container *ngIf="!loadingMovs; else loadingTpl">
    <p-table [value]="movimientosCaja" scrollable="true" scrollHeight="420px" [responsive]="true">
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Monto (COP)</th>
          <th>Cuenta Origen</th>
          <th>Cuenta Destino</th>
          <th>Caja</th>
          <th>Cliente</th>
          <th>Proveedor</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-mov>
        <tr>
          <td>{{ mov.fecha | date:'short' }}</td>
          <td>{{ mov.tipo }}</td>
          <td>{{ mov.monto | currency:'COP':'symbol':'1.0-0' }}</td>
          <td>{{ mov.cuentaOrigen || '-' }}</td>
          <td>{{ mov.cuentaDestino || '-' }}</td>
          <td>{{ mov.caja || '-' }}</td>
          <td>{{ mov.pagoCliente || '-' }}</td>
          <td>{{ mov.pagoProveedor || '-' }}</td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="p-text-center">Sin movimientos para esta caja.</td>
        </tr>
      </ng-template>
    </p-table>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="p-3">Cargando movimientos...</div>
  </ng-template>
</p-dialog>
