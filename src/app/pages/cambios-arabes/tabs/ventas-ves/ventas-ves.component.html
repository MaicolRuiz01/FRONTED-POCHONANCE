<!-- HEADER ACTION -->
<div class="flex justify-content-between align-items-center mb-3">
  <div class="text-xl font-semibold">Ventas VES</div>

  <button
    pButton
    icon="pi pi-plus"
    label="Nueva venta"
    (click)="new()"
  ></button>
</div>

<!-- DIALOG -->
<p-dialog
  [(visible)]="showForm"
  [modal]="true"
  [dismissableMask]="true"
  [style]="{ width: '52rem', maxWidth: '95vw' }"
  [header]="editingId ? 'Editar venta VES' : 'Nueva venta VES'"
>
  <form [formGroup]="form" (ngSubmit)="submit()" class="p-fluid">

    <!-- GRID INPUTS -->
    <div class="grid">
      <div class="col-12 md:col-4">
        <label class="block mb-2">Bolívares (VES)</label>
        <p-inputNumber
          formControlName="bolivares"
          [minFractionDigits]="2"
          [useGrouping]="true"
          placeholder="0"
          styleClass="w-full"
        ></p-inputNumber>
      </div>

      <div class="col-12 md:col-4">
        <label class="block mb-2">Tasa (COP)</label>
        <p-inputNumber
          formControlName="tasa"
          [minFractionDigits]="2"
          [useGrouping]="true"
          placeholder="0"
          styleClass="w-full"
        ></p-inputNumber>
      </div>

      <div class="col-12 md:col-4">
        <label class="block mb-2">Pesos (preview)</label>
        <p-inputNumber
          formControlName="pesosPreview"
          [minFractionDigits]="0"
          [useGrouping]="true"
          [disabled]="true"
          styleClass="w-full"
        ></p-inputNumber>
      </div>
    </div>

    <p-divider class="my-3"></p-divider>

    <!-- ASIGNACIÓN -->
    <div class="flex align-items-center gap-4 mb-3">
      <span class="font-medium">Asignar a:</span>

      <div class="flex align-items-center gap-2">
        <p-radioButton inputId="rbCuenta" name="asignadoA" value="cuenta" formControlName="asignadoA"></p-radioButton>
        <label for="rbCuenta" class="cursor-pointer">Cuenta COP</label>
      </div>

      <div class="flex align-items-center gap-2">
        <p-radioButton inputId="rbCliente" name="asignadoA" value="cliente" formControlName="asignadoA"></p-radioButton>
        <label for="rbCliente" class="cursor-pointer">Cliente</label>
      </div>

      <div class="flex align-items-center gap-2">
        <p-radioButton inputId="rbProveedor" name="asignadoA" value="proveedor" formControlName="asignadoA"></p-radioButton>
        <label for="rbProveedor" class="cursor-pointer">Proveedor</label>
      </div>
    </div>

    <!-- DROPDOWN SEGÚN ELECCIÓN -->
    <div class="grid">
      <div class="col-12" *ngIf="form.value.asignadoA === 'cuenta'">
        <label class="block mb-2">Cuenta COP</label>
        <p-dropdown
          [options]="cuentasCop"
          optionLabel="name"
          optionValue="id"
          placeholder="Seleccione cuenta"
          formControlName="cuentaCopId"
          styleClass="w-full"
          [filter]="true"
          filterBy="name"
        ></p-dropdown>
      </div>

      <div class="col-12" *ngIf="form.value.asignadoA === 'cliente'">
        <label class="block mb-2">Cliente</label>
        <p-dropdown
          [options]="clientes"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Seleccione cliente"
          formControlName="clienteId"
          styleClass="w-full"
          [filter]="true"
          filterBy="nombre"
        ></p-dropdown>
      </div>

      <div class="col-12" *ngIf="form.value.asignadoA === 'proveedor'">
        <label class="block mb-2">Proveedor</label>
        <p-dropdown
          [options]="suppliers"
          optionLabel="name"
          optionValue="id"
          placeholder="Seleccione proveedor"
          formControlName="proveedorId"
          styleClass="w-full"
          [filter]="true"
          filterBy="name"
        ></p-dropdown>
      </div>
    </div>

    <!-- FOOTER -->
    <ng-template pTemplate="footer">
      <div class="flex justify-content-end gap-2">
        <button
          pButton
          type="button"
          label="Cancelar"
          class="p-button-text"
          (click)="cancel()"
        ></button>

        <button
          pButton
          type="submit"
          icon="pi pi-save"
          [label]="editingId ? 'Actualizar' : 'Guardar'"
        ></button>
      </div>
    </ng-template>

  </form>
</p-dialog>

<!-- TABLA -->
<p-card header="Ventas registradas" class="mt-3">
  <p-table [value]="rows" [paginator]="true" [rows]="10" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>Fecha</th>
        <th>VES</th>
        <th>Tasa</th>
        <th>Pesos</th>
        <th>Asignado a</th>
        <th style="width: 110px"></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-r>
      <tr>
        <td>{{ r.date | date:'short' }}</td>
        <td>{{ r.bolivares | number:'1.2-2' }}</td>
        <td>{{ r.tasa | number:'1.2-2' }}</td>
        <td>{{ r.pesos | number:'1.0-0' }}</td>

        <td>
          {{
            r.cuentaCop?.id ? ('Cuenta COP #' + r.cuentaCop.id) :
            r.cliente?.id ? ('Cliente #' + r.cliente.id) :
            ('Proveedor #' + r.proveedor?.id)
          }}
        </td>

        <td class="text-right">
          <button pButton icon="pi pi-pencil" class="p-button-text" (click)="edit(r)"></button>
          <button pButton icon="pi pi-trash" class="p-button-text p-button-danger" (click)="remove(r)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>
