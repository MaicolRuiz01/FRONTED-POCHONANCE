<div class="contenedor-clientes">
  <div class="header">
    <h2>Clientes Especiales</h2>
    <button pButton label="Nuevo Cliente" icon="pi pi-plus" class="p-button-success" (click)="abrirModal()"></button>
  </div>

<div>
  <button pButton 
          label="Pagar a Cliente" 
          icon="pi pi-credit-card" 
          class="p-button-danger" 
          (click)="abrirModalPago()">
  </button>
</div>

  <br>

<div class="total-container">  
<p-card styleClass="total-card">
    <ng-template pTemplate="content">
      <div class="total-content">
        <i class="pi pi-calculator" style="margin-right: 6px;"></i>
        <strong>Total de Clientes:</strong> {{ totalClientes | currency:'COP' }}
      </div>
    </ng-template>
</p-card>
</div>
<br>
<br>
  <!-- Grid de clientes -->
  <div class="grid-clientes">
    <div class="card" *ngFor="let cliente of clientes" (click)="selectedCliente = cliente; showMovimientosDialog = true">
      <h3>{{ cliente.nombre }}</h3>
      <p><strong>Usuario:</strong> {{ cliente.nameUser }}</p>
      <p><strong>Correo:</strong> {{ cliente.correo }}</p>
      <p><strong>Saldo:</strong> {{ cliente.saldo | currency:'COP' }}</p>
      <p><strong>Wallet:</strong> {{ cliente.wallet }}</p>
    </div>
  </div>

  <!-- Modal de Movimientos del Cliente -->
<p-dialog header="Movimientos del Cliente: {{ selectedCliente?.nombre }}" 
          [(visible)]="showMovimientosDialog" 
          [modal]="true" 
          [style]="{width: '80vw'}"
          [closable]="true" 
          (onHide)="showMovimientosDialog = false">

    <p-table [value]="clienteMovimientos">
        <ng-template pTemplate="header">
            <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Monto (USD)</th>
                <th>Monto (COP)</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-movimiento>
            <tr>
                <td>{{ movimiento.fecha | date: 'short' }}</td>
                <td>{{ movimiento.tipo }}</td>
                <td>{{ movimiento.montoUsd | currency:'USD' }}</td>
                <td>{{ movimiento.montoCop | currency:'COP' }}</td>
            </tr>
        </ng-template>
    </p-table>

</p-dialog>

  <!-- Modal crear cliente -->
  <p-dialog header="Crear Nuevo Cliente" [(visible)]="displayModal" [modal]="true" [style]="{ width: '400px' }">
    <form class="p-fluid">
      <div class="p-field">
        <label>Nombre</label>
        <input pInputText [(ngModel)]="nuevoCliente.nombre" name="nombre" />
      </div>
      <div class="p-field">
        <label>Usuario</label>
        <input pInputText [(ngModel)]="nuevoCliente.nameUser" name="nameUser" />
      </div>
      <div class="p-field">
        <label>Correo</label>
        <input pInputText [(ngModel)]="nuevoCliente.correo" name="corre" />
      </div>
      <div class="p-field">
        <label>Saldo Inicial</label>
        <p-inputNumber [(ngModel)]="nuevoCliente.saldo" name="saldo" mode="currency" currency="COP"></p-inputNumber>
      </div>
      <div class="p-field">
        <label>Wallet</label>
        <input pInputText [(ngModel)]="nuevoCliente.wallet" name="wallet" />
      </div>
    </form>




    <ng-template pTemplate="footer">
      <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="displayModal = false"></button>
      <button pButton label="Guardar" icon="pi pi-check" class="p-button-success" (click)="guardarCliente()"></button>
    </ng-template>
  </p-dialog>

  <!-- Modal de Pago entre Clientes -->
<p-dialog header="Pago entre Clientes" 
           [(visible)]="displayPagoModal" 
           [modal]="true" 
           [style]="{ width: '400px' }">
  <form class="p-fluid">
    <!-- Cliente Origen -->
    <div class="p-field">
      <label>Cliente Origen</label>
      <p-dropdown 
        [options]="clientes" 
        [(ngModel)]="pago.origenId" 
        name="origen" 
        optionLabel="nombre" 
        optionValue="id" 
        placeholder="Seleccione cliente origen">
      </p-dropdown>
      <br>
      <label>Tasa de Cliente Origen</label>
      <p-inputNumber [(ngModel)]="tasaOrigen" name="tasaOrigen" mode="currency" currency="COP"></p-inputNumber>
       </div>
       <br>

       <!-- Monto a pagar cliente origen-->
    <div class="p-field">
      <label>Monto a Pagar de cliente Origen</label>
      <p-inputNumber 
        [(ngModel)]="pago.monto" 
        name="monto" 
        mode="currency" 
        currency="COP" 
        [min]="0">
      </p-inputNumber>
    </div>
 <br>
    <!-- Cliente Destino -->
    <div class="p-field">
      <label>Cliente Destino</label>
      <p-dropdown 
        [options]="clientes" 
        [(ngModel)]="pago.destinoId" 
        name="destino" 
        optionLabel="nombre" 
        optionValue="id" 
        placeholder="Seleccione cliente destino">
      </p-dropdown>
      <br>
      <label>Tasa de Cliente Destino</label>
      <p-inputNumber [(ngModel)]="tasaDestino" name="tasaDestino" mode="currency" currency="COP"></p-inputNumber>
      <br>
    </div>
<br>
    <!-- Nota -->
    <div class="p-field">
      <label>Nota (opcional)</label>
      <input pInputText [(ngModel)]="pago.nota" name="nota" />
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button pButton 
            label="Cancelar" 
            icon="pi pi-times" 
            class="p-button-text" 
            (click)="displayPagoModal = false">
    </button>
    <button pButton 
            label="Confirmar Pago" 
            icon="pi pi-check" 
            class="p-button-success" 
            (click)="confirmarPago()"
            [disabled]="!pago.origenId || !pago.destinoId || !pago.monto">
    </button>
  </ng-template>
</p-dialog>

</div>

